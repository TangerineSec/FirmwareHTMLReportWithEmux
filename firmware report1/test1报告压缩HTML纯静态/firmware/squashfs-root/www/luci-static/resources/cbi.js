function cbi_d_add(e,t,n){var r=document.getElementById(e);if(r){var i;for(var s=0;s<cbi_d.length;s++)if(cbi_d[s].id==e){i=cbi_d[s];break}i||(i={node:r,id:e,parent:r.parentNode.id,next:n,deps:[]},cbi_d.unshift(i)),i.deps.push(t)}}function cbi_d_checkvalue(e,t){var n=document.getElementById(e),r;if(!n){var i=document.getElementsByName(e);if(i.length>0&&i[0].type=="radio")for(var s=0;s<i.length;s++)if(i[s].checked){r=i[s].value;break}r=r?r:""}else n.value?(r=n.value,n.type=="checkbox"&&(r=n.checked?r:"")):r="";return r==t}function cbi_d_check(e){var t,n=!1;for(var r=0;r<e.length;r++){var i=!0;t=!1;for(var s in e[r])s=="!reverse"?t=!0:s=="!default"?(n=!0,i=!1):i=i&&cbi_d_checkvalue(s,e[r][s]);if(i)return!t}return n}function cbi_d_update(){var e=!1;for(var t=0;t<cbi_d.length;t++){var n=cbi_d[t],r=document.getElementById(n.next),i=document.getElementById(n.id),s=document.getElementById(n.parent);i&&i.parentNode&&!cbi_d_check(n.deps)?(i.parentNode.removeChild(i),e=!0,n.parent&&cbi_c[n.parent]--):(!i||!i.parentNode)&&cbi_d_check(n.deps)&&(r?r.parentNode.insertBefore(n.node,r):s.appendChild(n.node),e=!0,n.parent&&cbi_c[n.parent]++)}n&&n.parent&&(cbi_t_update()||cbi_tag_last(s)),e&&cbi_d_update()}function cbi_bind(e,t,n,r){return e.addEventListener?e.addEventListener(t,n,!!r):e.attachEvent("on"+t,function(){var e=window.event;return!e.target&&e.srcElement&&(e.target=e.srcElement),!!n(e)}),e}function cbi_combobox(e,t,n,r){var i="cbi.combobox."+e;if(document.getElementById(i))return;var s=document.getElementById(e),o=document.createElement("select");o.id=i,o.className=s.className.replace(/cbi-input-text/,"cbi-input-select"),s.nextSibling?s.parentNode.insertBefore(o,s.nextSibling):s.parentNode.appendChild(o);var u=s.getAttribute("cbi_datatype"),a=s.getAttribute("cbi_optional");u&&cbi_validate_field(o,a=="true",u);if(!t[s.value])if(s.value==""){var f=document.createElement("option");f.value="",f.appendChild(document.createTextNode(n)),o.appendChild(f)}else{var l=document.createElement("option");l.value=s.value,l.selected="selected",l.appendChild(document.createTextNode(s.value)),o.appendChild(l)}for(var c in t){var l=document.createElement("option");l.value=c,s.value==c&&(l.selected="selected"),l.appendChild(document.createTextNode(t[c])),o.appendChild(l)}var h=document.createElement("option");h.value="",h.appendChild(document.createTextNode(r)),o.appendChild(h),s.style.display="none",cbi_bind(o,"change",function(){o.selectedIndex==o.options.length-1?(s.style.display="inline",o.parentNode.removeChild(o),s.focus()):s.value=o.options[o.selectedIndex].value;try{cbi_d_update()}catch(e){}}),o.focus(),o.blur()}function cbi_combobox_init(e,t,n,r){var i=document.getElementById(e);cbi_bind(i,"blur",function(){cbi_combobox(e,t,n,r)}),cbi_combobox(e,t,n,r)}function cbi_filebrowser(e,t,n){var r=document.getElementById(e),i=window.open(t+(r.value||n||"")+"?field="+e,"luci_filebrowser","width=300,height=400,left=100,top=200,scrollbars=yes");i.focus()}function cbi_browser_init(e,t,n,r){function i(t){return cbi_filebrowser(e,n,r),!1}var s=document.getElementById(e),o=document.createElement("img");o.className="cbi-image-button",o.src=t+"/cbi/folder.gif",s.parentNode.insertBefore(o,s.nextSibling),cbi_bind(o,"click",i)}function cbi_dynlist_init(e,t,n,r,i){function l(e,s,l){f=[];while(u.firstChild){var d=u.firstChild,v=parseInt(d.index);v!=l&&(d.nodeName.toLowerCase()=="input"?f.push(d.value||""):d.nodeName.toLowerCase()=="select"&&(f[f.length-1]=d.options[d.selectedIndex].value)),u.removeChild(d)}s>=0?(e=s+1,f.splice(e,0,"")):f.length==0&&(e=0,f.push(""));for(var v=0;v<f.length;v++){var m=document.createElement("input");m.id=o+"."+(v+1),m.name=o,m.value=f[v],m.type="text",m.index=v,m.className="cbi-input-text",v==0&&a&&(m.placeholder=a);var g=document.createElement("img");g.src=t+(v+1<f.length?"/cbi/remove.gif":"/cbi/add.gif"),g.className="cbi-image-button",u.appendChild(m),u.appendChild(g),u.appendChild(document.createElement("br")),n&&cbi_validate_field(m.id,v+1==f.length||r,n);if(i)cbi_combobox_init(m.id,i[0],"",i[1]),m.nextSibling.index=v,cbi_bind(m.nextSibling,"keydown",h),cbi_bind(m.nextSibling,"keypress",c),(v==e||-v==e)&&m.nextSibling.focus();else{cbi_bind(m,"keydown",h),cbi_bind(m,"keypress",c);if(v==e)m.focus();else if(-v==e){m.focus();var y=m.value;m.value=" ",m.value=y}}cbi_bind(g,"click",p)}}function c(e){e=e?e:window.event;var t=e.target?e.target:e.srcElement;t.nodeType==3&&(t=t.parentNode);switch(e.keyCode){case 8:case 46:if(t.value.length==0)return e.preventDefault&&e.preventDefault(),!1;return!0;case 13:case 38:case 40:return e.preventDefault&&e.preventDefault(),!1}return!0}function h(t){t=t?t:window.event;var n=t.target?t.target:t.srcElement;n.nodeType==3&&(n=n.parentNode);var r=n.previousSibling;while(r&&r.name!=e)r=r.previousSibling;var i=n.nextSibling;while(i&&i.name!=e)i=i.nextSibling;i&&i.nextSibling.name==e&&(i=i.nextSibling);switch(t.keyCode){case 8:case 46:var s=n.nodeName.toLowerCase()=="select"?!0:n.value.length==0;if(s){t.preventDefault&&t.preventDefault();var o=n.index;return t.keyCode==8&&(o=-o+1),l(o,-1,n.index),!1}break;case 13:l(-1,n.index,-1);break;case 38:r&&r.focus();break;case 40:i&&i.focus()}return!0}function p(e){e=e?e:window.event;var t=e.target?e.target:e.srcElement;return t.src.indexOf("remove")>-1?(t.previousSibling.value="",h({target:t.previousSibling,keyCode:8})):h({target:t.previousSibling,keyCode:13}),!1}var s=document.getElementsByName(e)[0],o=s.name,u=s.parentNode,a=s.placeholder,f;l(NaN,-1,-1)}function cbi_hijack_forms(e,t,n,r){var i=e.getElementsByTagName("form");for(var s=0;s<i.length;s++)$(i[s]).observe("submit",function(e){e.stop(),e.element().request({onSuccess:t,onFailure:n}),r&&r()})}function cbi_t_add(e,t){var n=document.getElementById("tab."+e+"."+t),r=document.getElementById("container."+e+"."+t);n&&r&&(cbi_t[e]=cbi_t[e]||[],cbi_t[e][t]={tab:n,container:r,cid:r.id})}function cbi_t_switch(e,t){if(cbi_t[e]&&cbi_t[e][t]){var n=cbi_t[e][t],r=document.getElementById("tab."+e);for(var i in cbi_t[e]){var s=cbi_t[e][i];n.tab.id!=s.tab.id?(s.tab.className=s.tab.className.replace(/(^| )cbi-tab( |$)/," cbi-tab-disabled "),s.container.style.display="none"):(r&&(r.value=t),s.tab.className=s.tab.className.replace(/(^| )cbi-tab-disabled( |$)/," cbi-tab "),s.container.style.display="block")}}return!1}function cbi_t_update(){var e=[],t=!1;for(var n in cbi_t)for(var r in cbi_t[n]){if(cbi_c[cbi_t[n][r].cid]==0)cbi_t[n][r].tab.style.display="none";else if(cbi_t[n][r].tab&&cbi_t[n][r].tab.style.display=="none"){cbi_t[n][r].tab.style.display="";var i=cbi_t[n][r].tab;i.className+=" cbi-tab-highlighted",e.push(i)}cbi_tag_last(cbi_t[n][r].container),t=!0}return e.length>0&&window.setTimeout(function(){for(var t=0;t<e.length;t++)e[t].className=e[t].className.replace(/ cbi-tab-highlighted/g,"")},750),t}function cbi_validate_form(e,t){if(e.cbi_state=="add-section"||e.cbi_state=="del-section")return!0;if(e.cbi_validators)for(var n=0;n<e.cbi_validators.length;n++){var r=e.cbi_validators[n];if(!r()&&t)return alert(t),!1}return!0}function cbi_validate_reset(e){return window.setTimeout(function(){cbi_validate_form(e,null)},100),!0}function cbi_validate_compile(e){var t=0,n=!1,r=0,i=[];e+=",";for(var s=0;s<e.length;s++){if(n){n=!1;continue}switch(e.charCodeAt(s)){case 92:n=!0;break;case 40:case 44:if(r<=0){if(t<s){var o=e.substring(t,s);o=o.replace(/\\(.)/g,"$1"),o=o.replace(/^[ \t]+/g,""),o=o.replace(/[ \t]+$/g,"");if(o&&!isNaN(o))i.push(parseFloat(o));else if(o.match(/^(['"]).*\1$/))i.push(o.replace(/^(['"])(.*)\1$/,"$2"));else{if(typeof cbi_validators[o]!="function")throw"Syntax error, unhandled token '"+o+"'";i.push(cbi_validators[o]),i.push(null)}}t=s+1}r+=e.charCodeAt(s)==40;break;case 41:if(--r<=0){if(typeof i[i.length-2]!="function")throw"Syntax error, argument list follows non-function";i[i.length-1]=arguments.callee(e.substring(t,s)),t=s+1}}}return i}function cbi_validate_field(e,t,n){var r=typeof e=="string"?document.getElementById(e):e,i;try{i=cbi_validate_compile(n)}catch(s){}if(r&&i&&typeof i[0]=="function"){var o=function(){if(r.form){r.className=r.className.replace(/ cbi-input-invalid/g,"");var e=r.options&&r.options.selectedIndex>-1?r.options[r.options.selectedIndex].value:r.value;if(!(e.length==0&&t||i[0].apply(e,i[1])))return r.className+=" cbi-input-invalid",!1}return!0};r.form.cbi_validators||(r.form.cbi_validators=[]),r.form.cbi_validators.push(o),cbi_bind(r,"blur",o),cbi_bind(r,"keyup",o),r.nodeName=="SELECT"&&(cbi_bind(r,"change",o),cbi_bind(r,"click",o)),r.setAttribute("cbi_validate",o),r.setAttribute("cbi_datatype",n),r.setAttribute("cbi_optional",(!!t).toString()),o();var u=document.getElementById("cbi.combobox."+r.id);u&&cbi_validate_field(u,t,n)}}function cbi_row_swap(e,t,n){var r=e.parentNode;while(r&&r.nodeName.toLowerCase()!="tr")r=r.parentNode;if(!r)return!1;var i=r.parentNode;while(i&&i.nodeName.toLowerCase()!="table")i=i.parentNode;if(!i)return!1;var s=t?3:2,o=t?i.rows.length:i.rows.length-1;for(var u=s;u<o;u++)if(i.rows[u]==r){t?r.parentNode.insertBefore(i.rows[u],i.rows[u-1]):r.parentNode.insertBefore(i.rows[u+1],i.rows[u]);break}var a=[];for(u=2;u<i.rows.length;u++)i.rows[u].className=i.rows[u].className.replace(/cbi-rowstyle-[12]/,"cbi-rowstyle-"+(1+u%2)),i.rows[u].id&&i.rows[u].id.match(/-([^\-]+)$/)&&a.push(RegExp.$1);var f=document.getElementById(n);return f&&(f.value=a.join(" ")),!1}function cbi_tag_last(e){var t;for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];r.nodeType==1&&r.nodeName.toLowerCase()=="div"&&(r.className=r.className.replace(/ cbi-value-last$/,""),t=r)}t&&(t.className+=" cbi-value-last")}var cbi_d=[],cbi_t=[],cbi_c=[],cbi_validators={integer:function(){return this.match(/^-?[0-9]+$/)!=null},uinteger:function(){return cbi_validators.integer.apply(this)&&this>=0},"float":function(){return!isNaN(parseFloat(this))},ufloat:function(){return cbi_validators["float"].apply(this)&&this>=0},ipaddr:function(){return cbi_validators.ip4addr.apply(this)||cbi_validators.ip6addr.apply(this)},ip4addr:function(){return this.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})(\/(\S+))?$/)?RegExp.$1>=0&&RegExp.$1<=255&&RegExp.$2>=0&&RegExp.$2<=255&&RegExp.$3>=0&&RegExp.$3<=255&&RegExp.$4>=0&&RegExp.$4<=255&&(RegExp.$6.indexOf(".")<0?RegExp.$6>=0&&RegExp.$6<=32:cbi_validators.ip4addr.apply(RegExp.$6)):!1},ip6addr:function(){if(this.match(/^([a-fA-F0-9:.]+)(\/(\d+))?$/))if(!RegExp.$2||RegExp.$3>=0&&RegExp.$3<=128){var e=RegExp.$1;if(e=="::")return!0;if(e.indexOf(".")>0){var t=e.lastIndexOf(":");if(!t||!cbi_validators.ip4addr.apply(e.substr(t+1)))return!1;e=e.substr(0,t)+":0:0"}if(e.indexOf("::")>=0){var n=0,r="0";for(var i=1;i<e.length-1;i++)e.charAt(i)==":"&&n++;if(n>7)return!1;for(var i=0;i<7-n;i++)r+=":0";e.match(/^(.*?)::(.*?)$/)&&(e=(RegExp.$1?RegExp.$1+":":"")+r+(RegExp.$2?":"+RegExp.$2:""))}return e.match(/^(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}$/)!=null}return!1},port:function(){return cbi_validators.integer.apply(this)&&this>=0&&this<=65535},portrange:function(){if(this.match(/^(\d+)-(\d+)$/)){var e=RegExp.$1,t=RegExp.$2;return cbi_validators.port.apply(e)&&cbi_validators.port.apply(t)&&parseInt(e)<=parseInt(t)}return cbi_validators.port.apply(this)},macaddr:function(){return this.match(/^([a-fA-F0-9]{2}:){5}[a-fA-F0-9]{2}$/)!=null},host:function(){return cbi_validators.hostname.apply(this)||cbi_validators.ipaddr.apply(this)},hostname:function(){return this.length<=253?this.match(/^[a-zA-Z0-9]+$/)!=null||this.match(/^[a-zA-Z0-9_][a-zA-Z0-9_\-.]*[a-zA-Z0-9]$/)&&this.match(/[^0-9.]/):!1},network:function(){return cbi_validators.uciname.apply(this)||cbi_validators.host.apply(this)},wpakey:function(){var e=this;return e.length==64?e.match(/^[a-fA-F0-9]{64}$/)!=null:e.length>=8&&e.length<=63},wepkey:function(){var e=this;return e.substr(0,2)=="s:"&&(e=e.substr(2)),e.length==10||e.length==26?e.match(/^[a-fA-F0-9]{10,26}$/)!=null:e.length==5||e.length==13},uciname:function(){return this.match(/^[a-zA-Z0-9_]+$/)!=null},range:function(e,t){var n=parseFloat(this);return!isNaN(e)&&!isNaN(t)&&!isNaN(n)?n>=e&&n<=t:!1},min:function(e){var t=parseFloat(this);return!isNaN(e)&&!isNaN(t)?t>=e:!1},max:function(e){var t=parseFloat(this);return!isNaN(e)&&!isNaN(t)?t<=e:!1},rangelength:function(e,t){var n=""+this;return!isNaN(e)&&!isNaN(t)?n.length>=e&&n.length<=t:!1},minlength:function(e){var t=""+this;return isNaN(e)?!1:t.length>=e},maxlength:function(e){var t=""+this;return isNaN(e)?!1:t.length<=e},or:function(){for(var e=0;e<arguments.length;e+=2)if(typeof arguments[e]!="function"){if(arguments[e]==this)return!0;e--}else if(arguments[e].apply(this,arguments[e+1]))return!0;return!1},and:function(){for(var e=0;e<arguments.length;e+=2)if(typeof arguments[e]!="function"){if(arguments[e]!=this)return!1;e--}else if(!arguments[e].apply(this,arguments[e+1]))return!1;return!0},neg:function(){return cbi_validators.or.apply(this.replace(/^[ \t]*![ \t]*/,""),arguments)},list:function(e,t){if(typeof e!="function")return!1;var n=this.match(/[^ \t]+/g);for(var r=0;r<n.length;r++)if(!e.apply(n[r],t))return!1;return!0},phonedigit:function(){return this.match(/^[0-9\*#]+$/)!=null}};String.prototype.serialize=function(){var e=this;switch(typeof e){case"object":if(e==null)return"null";if(e.length){var t,n="";for(var t=0;t<e.length;t++)n+=(n?", ":"")+String.serialize(e[t]);return"[ "+n+" ]"}var r,n="";for(r in e)n+=(n?", ":"")+r+": "+String.serialize(e[r]);return"{ "+n+" }";case"string":return e.match(/[^a-zA-Z0-9_,.: -]/)?'decodeURIComponent("'+encodeURIComponent(e)+'")':'"'+e+'"';default:return e.toString()}},String.prototype.format=function(){function n(e,t){for(var n=0;n<t.length;n+=2)e=e.replace(t[n],t[n+1]);return e}if(!RegExp)return;var e=[/&/g,"&#38;",/"/g,"&#34;",/'/g,"&#39;",/</g,"&#60;",/>/g,"&#62;"],t=[/"/g,"&#34;",/'/g,"&#39;"],r=this,i="",s=/^(([^%]*)%('.|0|\x20)?(-)?(\d+)?(\.\d+)?(%|b|c|d|u|f|o|s|x|X|q|h|j|t|m))/,o=b=[],u=0,a=0;while(o=s.exec(r)){var f=o[1],l=o[2],c=o[3],h=o[4],p=o[5],d=o[6],v=o[7];a++;if(v=="%")S="%";else if(u<arguments.length){var m=arguments[u++],g="";c&&c.substr(0,1)=="'"?g=l.substr(1,1):c&&(g=c);var y=!0;h&&h==="-"&&(y=!1);var w=-1;p&&(w=parseInt(p));var E=-1;d&&v=="f"&&(E=parseInt(d.substring(1)));var S=m;switch(v){case"b":S=(parseInt(m)||0).toString(2);break;case"c":S=String.fromCharCode(parseInt(m)||0);break;case"d":S=parseInt(m)||0;break;case"u":S=Math.abs(parseInt(m)||0);break;case"f":S=E>-1?(parseFloat(m)||0).toFixed(E):parseFloat(m)||0;break;case"o":S=(parseInt(m)||0).toString(8);break;case"s":S=m;break;case"x":S=(""+(parseInt(m)||0).toString(16)).toLowerCase();break;case"X":S=(""+(parseInt(m)||0).toString(16)).toUpperCase();break;case"h":S=n(m,e);break;case"q":S=n(m,t);break;case"j":S=String.serialize(m);break;case"t":var x=0,T=0,N=0,C=m||0;C>60&&(N=Math.floor(C/60),C%=60),N>60&&(T=Math.floor(N/60),N%=60),T>24&&(x=Math.floor(T/24),T%=24),S=x>0?String.format("%dd %dh %dm %ds",x,T,N,C):String.format("%dh %dm %ds",T,N,C);break;case"m":var k=p?parseInt(p):1e3,L=d?Math.floor(10*parseFloat("0"+d)):2,A=0,O=parseFloat(m||0),M=["","K","M","G","T","P","E"];for(A=0;A<M.length&&O>k;A++)O/=k;S=O.toFixed(L)+" "+M[A]}}i+=l+S,r=r.substr(f.length)}return i+r},String.prototype.nobr=function(){return this.replace(/[\s\n]+/g,"&#160;")},String.serialize=function(){var e=[];for(var t=1;t<arguments.length;t++)e.push(arguments[t]);return"".serialize.apply(arguments[0],e)},String.format=function(){var e=[];for(var t=1;t<arguments.length;t++)e.push(arguments[t]);return"".format.apply(arguments[0],e)},String.nobr=function(){var e=[];for(var t=1;t<arguments.length;t++)e.push(arguments[t]);return"".nobr.apply(arguments[0],e)}